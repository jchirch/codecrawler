@if (loading()) {
  <p class="status-msg">Loading campaign‚Ä¶</p>
} @else if (error()) {
  <div class="error-banner">{{ error() }}</div>
} @else if (campaign()) {
  <div class="chat-page">

    <!-- Compact campaign header -->
    <div class="chat-header">
      <a class="back-link" routerLink="/campaigns">‚Üê Campaigns</a>
      <div class="header-info">
        <span class="campaign-name">{{ campaign()!.name }}</span>
        <div class="badges">
          <span class="badge theme">{{ campaign()!.theme }}</span>
          <span class="badge difficulty" [class]="'diff-' + campaign()!.difficulty.toLowerCase()">
            {{ campaign()!.difficulty }}
          </span>
        </div>
      </div>
    </div>

    <!-- Scrollable messages -->
    <div class="messages-area" #messageList>
      @if (messages().length === 0) {
        <div class="empty-state">
          <p>üó∫Ô∏è No messages yet. Start your adventure!</p>
        </div>
      }
      @for (msg of messages(); track msg.id) {
        <div class="message-row" [class.own]="isCurrentUser(msg.user_id)">
          <div class="message-bubble">
            <div class="message-meta">
              <span class="message-email">{{ msg.email }}</span>
              <span class="message-time">{{ msg.created_at | date:'shortTime' }}</span>
            </div>
            <div class="message-content">{{ msg.content }}</div>
          </div>
        </div>
      }
    </div>

    <!-- Input area -->
    <div class="input-area">
      <textarea
        [(ngModel)]="messageContent"
        (keydown)="onKeydown($event)"
        placeholder="Type your message‚Ä¶ (Enter to send, Shift+Enter for new line)"
        [disabled]="sending()"
        rows="1"
      ></textarea>
      <button class="send-btn" (click)="sendMessage()" [disabled]="sending() || !messageContent.trim()">
        {{ sending() ? '‚Ä¶' : '‚û§' }}
      </button>
    </div>

  </div>
}

